(function(a,b){if(typeof define==="function"&&define.amd){define(["./Decoder","./WebGLCanvas"],b)}else{if(typeof exports==="object"){module.exports=b(require("./Decoder"),require("./WebGLCanvas"))}else{a.Player=b(a.Decoder,a.WebGLCanvas)}}}(this,function(c,d){var b=c.nowValue;var a=function(f){var n=this;this._config=f||{};this.render=true;if(this._config.render===false){this.render=false}this.nowValue=b;this._config.workerFile=this._config.workerFile||"Decoder.js";if(this._config.preserveDrawingBuffer){this._config.contextOptions=this._config.contextOptions||{};this._config.contextOptions.preserveDrawingBuffer=true}var g="auto";if(this._config.webgl===true){g=true}else{if(this._config.webgl===false){g=false}}if(g=="auto"){g=true;try{if(!window.WebGLRenderingContext){g=false}else{var j=document.createElement("canvas");var o=j.getContext("webgl");if(!o){g=false}}}catch(l){g=false}}this.webgl=g;if(this.webgl){this.createCanvasObj=this.createCanvasWebGL;this.renderFrame=this.renderFrameWebGL}else{this.createCanvasObj=this.createCanvasRGB;this.renderFrame=this.renderFrameRGB}var h;var m;var i=function(p,r,e,s){n.onPictureDecoded(p,r,e,s);var q=b();if(!p||!n.render){return}n.renderFrame({canvasObj:n.canvasObj,data:p,width:r,height:e});if(n.onRenderFrameComplete){n.onRenderFrameComplete({data:p,width:r,height:e,infos:s,canvasObj:n.canvasObj})}};if(!this._config.size){this._config.size={}}this._config.size.width=this._config.size.width||200;this._config.size.height=this._config.size.height||200;if(this._config.useWorker){var k=new Worker(this._config.workerFile);this.worker=k;k.addEventListener("message",function(q){var p=q.data;if(p.consoleLog){console.log(p.consoleLog);return}i.call(n,new Uint8Array(p.buf,0,p.length),p.width,p.height,p.infos)},false);k.postMessage({type:"Broadway.js - Worker init",options:{rgb:!g,memsize:this.memsize,reuseMemory:this._config.reuseMemory?true:false}});if(this._config.transferMemory){this.decode=function(e,p){k.postMessage({buf:e.buffer,offset:e.byteOffset,length:e.length,info:p},[e.buffer])}}else{this.decode=function(p,q){var e=new Uint8Array(p.length);e.set(p,0,p.length);k.postMessage({buf:e.buffer,offset:0,length:p.length,info:q},[e.buffer])}}if(this._config.reuseMemory){this.recycleMemory=function(e){k.postMessage({reuse:e.buffer},[e.buffer])}}}else{this.decoder=new c({rgb:!g});this.decoder.onPictureDecoded=i;this.decode=function(e,p){n.decoder.decode(e,p)}}if(this.render){this.canvasObj=this.createCanvasObj({contextOptions:this._config.contextOptions});this.canvas=this.canvasObj.canvas}this.domNode=this.canvas;h=this._config.size.width;m=this._config.size.height};a.prototype={onPictureDecoded:function(f,g,e,h){},recycleMemory:function(e){},createCanvasWebGL:function(f){var e=this._createBasicCanvasObj(f);e.contextOptions=f.contextOptions;return e},createCanvasRGB:function(f){var e=this._createBasicCanvasObj(f);return e},_createBasicCanvasObj:function(f){f=f||{};var h={};var g=f.width;if(!g){g=this._config.size.width}var e=f.height;if(!e){e=this._config.size.height}h.canvas=document.createElement("canvas");h.canvas.width=g;h.canvas.height=e;h.canvas.style.backgroundColor="#0D0E1B";return h},renderFrameWebGL:function(h){var g=h.canvasObj;var i=h.width||g.canvas.width;var e=h.height||g.canvas.height;if(g.canvas.width!==i||g.canvas.height!==e||!g.webGLCanvas){g.canvas.width=i;g.canvas.height=e;g.webGLCanvas=new d(g.canvas,undefined,g.contextOptions)}g.webGLCanvas.drawNextOutputPicture(i,e,null,h.data);var f=this;f.recycleMemory(h.data)},renderFrameRGB:function(i){var h=i.canvasObj;var j=i.width||h.canvas.width;var e=i.height||h.canvas.height;if(h.canvas.width!==j||h.canvas.height!==e){h.canvas.width=j;h.canvas.height=e}var f=h.ctx;var k=h.imgData;if(!f){h.ctx=h.canvas.getContext("2d");f=h.ctx;h.imgData=f.createImageData(j,e);k=h.imgData}k.data.set(i.data);f.putImageData(k,0,0);var g=this;g.recycleMemory(i.data)}};return a}));